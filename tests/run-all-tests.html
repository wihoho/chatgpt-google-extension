<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Calendar Extension - Test Suite</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .run-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px;
            transition: background 0.2s;
        }
        
        .run-button:hover {
            background: #45a049;
        }
        
        .run-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .results.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .results.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .results.info {
            background: #e2e3e5;
            border: 1px solid #d6d8db;
            color: #383d41;
        }
        
        .summary {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        
        .summary h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .feature-description {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
        }
        
        .feature-description h4 {
            margin-top: 0;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ ChatGPT Calendar Extension Test Suite</h1>
        <p>Comprehensive testing for new features: Review Prompt & Enhanced Error Handling</p>
    </div>

    <div class="test-section">
        <h2>üìã Feature Overview</h2>
        
        <div class="feature-description">
            <h4>üåü Feature 1: Chrome Web Store Review Prompt</h4>
            <p><strong>Purpose:</strong> Encourage users to leave reviews after successful calendar event creations</p>
            <ul>
                <li>Tracks successful calendar events in local storage</li>
                <li>Shows review prompt every 5 successful events (5, 10, 15, etc.)</li>
                <li>Provides "Review Now" and "Maybe Later" options</li>
                <li>Permanently dismisses prompt when user clicks "Review Now"</li>
                <li>Opens Chrome Web Store review page in new tab</li>
            </ul>
        </div>
        
        <div class="feature-description">
            <h4>‚ö†Ô∏è Feature 2: Enhanced Error Handling for Failed AI Detection</h4>
            <p><strong>Purpose:</strong> Provide better user experience when AI fails to extract event information</p>
            <ul>
                <li>Detects when AI extraction completely fails (no title, date, time, or location)</li>
                <li>Shows dedicated error dialog instead of empty confirmation modal</li>
                <li>Provides helpful tips for better text selection</li>
                <li>Includes "Retry" and "Cancel" buttons</li>
                <li>Failed extractions don't count toward review prompt counter</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>üß™ Test Suites</h2>
        
        <h3>1. Review Prompt Feature Tests</h3>
        <p>Tests event counting, prompt timing, and user interaction flows</p>
        <button class="run-button" onclick="runReviewPromptTests()">Run Review Prompt Tests</button>
        <div id="review-results" class="results info" style="display: none;"></div>
        
        <h3>2. Error Handling Feature Tests</h3>
        <p>Tests AI failure detection, error modal creation, and message handling</p>
        <button class="run-button" onclick="runErrorHandlingTests()">Run Error Handling Tests</button>
        <div id="error-results" class="results info" style="display: none;"></div>
        
        <h3>3. Timeout Handling Tests</h3>
        <p>Tests AI extraction timeout configuration and error handling</p>
        <button class="run-button" onclick="runTimeoutTests()">Run Timeout Tests</button>
        <div id="timeout-results" class="results info" style="display: none;"></div>

        <h3>4. Integration Tests</h3>
        <p>Tests interaction between all features and complete user journeys</p>
        <button class="run-button" onclick="runIntegrationTests()">Run Integration Tests</button>
        <div id="integration-results" class="results info" style="display: none;"></div>

        <h3>5. Run All Tests</h3>
        <p>Execute complete test suite for all features</p>
        <button class="run-button" onclick="runAllTests()" style="background: #007bff;">üöÄ Run All Tests</button>
        <div id="all-results" class="results info" style="display: none;"></div>
    </div>

    <div class="summary">
        <h3>üìä Test Summary</h3>
        <div id="test-summary">
            <p>Click "Run All Tests" to see comprehensive results, or run individual test suites above.</p>
            <p><strong>Expected Results:</strong> All tests should pass, indicating both features are working correctly and don't interfere with each other.</p>
        </div>
    </div>

    <script src="review-prompt.test.js"></script>
    <script src="error-handling.test.js"></script>
    <script src="timeout-handling.test.js"></script>
    <script src="integration.test.js"></script>
    
    <script>
        // Override console.log to capture test output
        function captureConsoleOutput(callback) {
            const originalLog = console.log;
            let output = '';
            
            console.log = function(...args) {
                output += args.join(' ') + '\n';
                originalLog.apply(console, args);
            };
            
            const result = callback();
            console.log = originalLog;
            
            if (result && typeof result.then === 'function') {
                return result.then(() => output);
            }
            
            return output;
        }
        
        async function runReviewPromptTests() {
            const button = event.target;
            const resultsDiv = document.getElementById('review-results');
            
            button.disabled = true;
            button.textContent = 'Running...';
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results info';
            resultsDiv.textContent = 'Running review prompt tests...\n';
            
            try {
                const output = await captureConsoleOutput(() => {
                    if (typeof runTests === 'function') {
                        return runTests();
                    } else {
                        throw new Error('Review prompt test function not found');
                    }
                });
                
                resultsDiv.textContent = output;
                resultsDiv.className = output.includes('All tests passed!') ? 'results success' : 'results error';
            } catch (error) {
                resultsDiv.textContent = `Error running tests: ${error.message}`;
                resultsDiv.className = 'results error';
            } finally {
                button.disabled = false;
                button.textContent = 'Run Review Prompt Tests';
            }
        }
        
        async function runErrorHandlingTests() {
            const button = event.target;
            const resultsDiv = document.getElementById('error-results');
            
            button.disabled = true;
            button.textContent = 'Running...';
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results info';
            resultsDiv.textContent = 'Running error handling tests...\n';
            
            try {
                const output = await captureConsoleOutput(() => {
                    if (typeof runAllTests === 'function') {
                        return runAllTests();
                    } else {
                        throw new Error('Error handling test function not found');
                    }
                });
                
                resultsDiv.textContent = output;
                resultsDiv.className = output.includes('All error handling tests passed!') ? 'results success' : 'results error';
            } catch (error) {
                resultsDiv.textContent = `Error running tests: ${error.message}`;
                resultsDiv.className = 'results error';
            } finally {
                button.disabled = false;
                button.textContent = 'Run Error Handling Tests';
            }
        }
        
        async function runTimeoutTests() {
            const button = event.target;
            const resultsDiv = document.getElementById('timeout-results');

            button.disabled = true;
            button.textContent = 'Running...';
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results info';
            resultsDiv.textContent = 'Running timeout handling tests...\n';

            try {
                const output = await captureConsoleOutput(() => {
                    if (typeof runTimeoutTests === 'function') {
                        return runTimeoutTests();
                    } else {
                        throw new Error('Timeout test function not found');
                    }
                });

                resultsDiv.textContent = output;
                resultsDiv.className = output.includes('All timeout tests passed!') ? 'results success' : 'results error';
            } catch (error) {
                resultsDiv.textContent = `Error running tests: ${error.message}`;
                resultsDiv.className = 'results error';
            } finally {
                button.disabled = false;
                button.textContent = 'Run Timeout Tests';
            }
        }

        async function runIntegrationTests() {
            const button = event.target;
            const resultsDiv = document.getElementById('integration-results');

            button.disabled = true;
            button.textContent = 'Running...';
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results info';
            resultsDiv.textContent = 'Running integration tests...\n';

            try {
                const output = await captureConsoleOutput(() => {
                    if (typeof runIntegrationTests === 'function') {
                        return runIntegrationTests();
                    } else {
                        throw new Error('Integration test function not found');
                    }
                });

                resultsDiv.textContent = output;
                resultsDiv.className = output.includes('All integration tests passed!') ? 'results success' : 'results error';
            } catch (error) {
                resultsDiv.textContent = `Error running tests: ${error.message}`;
                resultsDiv.className = 'results error';
            } finally {
                button.disabled = false;
                button.textContent = 'Run Integration Tests';
            }
        }
        
        async function runAllTests() {
            const button = event.target;
            const resultsDiv = document.getElementById('all-results');
            const summaryDiv = document.getElementById('test-summary');
            
            button.disabled = true;
            button.textContent = 'Running All Tests...';
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results info';
            resultsDiv.textContent = 'Running complete test suite...\n\n';
            
            let allOutput = '';
            let totalPassed = 0;
            let totalFailed = 0;
            
            try {
                // Run review prompt tests
                allOutput += '='.repeat(60) + '\n';
                allOutput += 'üåü REVIEW PROMPT FEATURE TESTS\n';
                allOutput += '='.repeat(60) + '\n';
                const reviewOutput = await captureConsoleOutput(() => runTests());
                allOutput += reviewOutput + '\n';
                
                // Run error handling tests
                allOutput += '='.repeat(60) + '\n';
                allOutput += '‚ö†Ô∏è  ERROR HANDLING FEATURE TESTS\n';
                allOutput += '='.repeat(60) + '\n';
                const errorOutput = await captureConsoleOutput(() => runAllTests());
                allOutput += errorOutput + '\n';

                // Run timeout handling tests
                allOutput += '='.repeat(60) + '\n';
                allOutput += '‚è±Ô∏è  TIMEOUT HANDLING TESTS\n';
                allOutput += '='.repeat(60) + '\n';
                const timeoutOutput = await captureConsoleOutput(() => runTimeoutTests());
                allOutput += timeoutOutput + '\n';

                // Run integration tests
                allOutput += '='.repeat(60) + '\n';
                allOutput += 'üîó INTEGRATION TESTS\n';
                allOutput += '='.repeat(60) + '\n';
                const integrationOutput = await captureConsoleOutput(() => runIntegrationTests());
                allOutput += integrationOutput + '\n';
                
                // Summary
                allOutput += '='.repeat(60) + '\n';
                allOutput += 'üìä FINAL SUMMARY\n';
                allOutput += '='.repeat(60) + '\n';
                
                const passedMatches = allOutput.match(/(\d+) passed/g);
                const failedMatches = allOutput.match(/(\d+) failed/g);
                
                if (passedMatches) {
                    totalPassed = passedMatches.reduce((sum, match) => sum + parseInt(match.match(/\d+/)[0]), 0);
                }
                
                if (failedMatches) {
                    totalFailed = failedMatches.reduce((sum, match) => sum + parseInt(match.match(/\d+/)[0]), 0);
                }
                
                allOutput += `Total Tests: ${totalPassed + totalFailed}\n`;
                allOutput += `Passed: ${totalPassed}\n`;
                allOutput += `Failed: ${totalFailed}\n\n`;
                
                if (totalFailed === 0) {
                    allOutput += 'üéâ ALL TESTS PASSED! Both features are working correctly.\n';
                    resultsDiv.className = 'results success';
                } else {
                    allOutput += `‚ö†Ô∏è  ${totalFailed} tests failed. Please review the implementation.\n`;
                    resultsDiv.className = 'results error';
                }
                
                resultsDiv.textContent = allOutput;
                
                // Update summary
                summaryDiv.innerHTML = `
                    <p><strong>Test Results:</strong> ${totalPassed} passed, ${totalFailed} failed</p>
                    <p><strong>Status:</strong> ${totalFailed === 0 ? '‚úÖ All tests passed!' : '‚ùå Some tests failed'}</p>
                    <p><strong>Features:</strong> ${totalFailed === 0 ? 'Ready for production' : 'Need review'}</p>
                `;
                
            } catch (error) {
                allOutput += `\nError running complete test suite: ${error.message}\n`;
                resultsDiv.textContent = allOutput;
                resultsDiv.className = 'results error';
                
                summaryDiv.innerHTML = `
                    <p><strong>Status:</strong> ‚ùå Test execution failed</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            } finally {
                button.disabled = false;
                button.textContent = 'üöÄ Run All Tests';
            }
        }
    </script>
</body>
</html>
