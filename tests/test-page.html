<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Calendar Extension - Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-text {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 16px;
            line-height: 1.5;
            cursor: text;
            user-select: text;
        }
        
        .test-text:hover {
            border-color: #007bff;
            background: #e7f3ff;
        }
        
        .test-text.selected {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .expected-result {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .debug-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .debug-button:hover {
            background: #5a6268;
        }
        
        .debug-output {
            background: #212529;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ ChatGPT Calendar Extension Test Page</h1>
        <p>Use this page to manually test the extension's functionality</p>
    </div>

    <div class="test-section">
        <h2>üéØ Test 1: Successful Event Extraction</h2>
        <div class="instructions">
            <strong>Instructions:</strong> Select the text below, right-click, and choose "Add to calendar"
        </div>
        
        <div class="test-text" id="test1">
            Team meeting tomorrow at 2:00 PM in Conference Room A to discuss the quarterly project updates and plan for next phase.
        </div>
        
        <div class="expected-result">
            <strong>Expected:</strong> Confirmation modal with extracted title, date/time, and location
        </div>
    </div>

    <div class="test-section">
        <h2>‚ö†Ô∏è Test 2: Failed Event Extraction (Error Modal)</h2>
        <div class="instructions">
            <strong>Instructions:</strong> Select the text below, right-click, and choose "Add to calendar"
        </div>
        
        <div class="test-text" id="test2">
            This is just some random text without any event information, dates, times, or meaningful content that could be converted into a calendar event.
        </div>
        
        <div class="expected-result">
            <strong>Expected:</strong> Error modal with warning icon and helpful tips for better text selection
        </div>
    </div>

    <div class="test-section">
        <h2>‚è±Ô∏è Test 3: Timeout Handling</h2>
        <div class="instructions">
            <strong>Instructions:</strong> Select the very long text below, right-click, and choose "Add to calendar"
        </div>
        
        <div class="test-text" id="test3">
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Team meeting at 3:00 PM tomorrow.
        </div>
        
        <div class="expected-result">
            <strong>Expected:</strong> Timeout error modal after 5 seconds with clock icon and timeout-specific messaging
        </div>
    </div>

    <div class="test-section">
        <h2>üåü Test 4: Review Prompt Feature</h2>
        <div class="instructions">
            <strong>Instructions:</strong> 
            <ol>
                <li>Clear storage using debug button below</li>
                <li>Perform 3 successful extractions using Test 1 text</li>
                <li>On the 3rd extraction, review prompt should appear</li>
            </ol>
        </div>
        
        <div class="test-text" id="test4">
            Doctor appointment on March 15th at 10:30 AM at Downtown Medical Center
        </div>
        
        <div class="expected-result">
            <strong>Expected:</strong> Review prompt appears in confirmation modal at 3rd successful event
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Debug Tools</h2>
        <div class="debug-section">
            <h3>Extension Storage</h3>
            <button class="debug-button" onclick="checkStorage()">Check Storage</button>
            <button class="debug-button" onclick="clearStorage()">Clear Storage</button>
            <button class="debug-button" onclick="setStorageValue()">Set Counter to 2</button>
            
            <h3>Extension Status</h3>
            <button class="debug-button" onclick="checkExtensionStatus()">Check Extension Status</button>
            <button class="debug-button" onclick="testContentScript()">Test Content Script</button>
            
            <h3>Manual Triggers</h3>
            <button class="debug-button" onclick="showTestErrorModal()">Show Error Modal</button>
            <button class="debug-button" onclick="showTestTimeoutModal()">Show Timeout Modal</button>
            
            <div id="debug-output" class="debug-output" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Debug functions
        function log(message, type = 'info') {
            const output = document.getElementById('debug-output');
            output.style.display = 'block';
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'success';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearDebugOutput() {
            document.getElementById('debug-output').innerHTML = '';
        }

        async function checkStorage() {
            clearDebugOutput();
            try {
                const result = await new Promise((resolve) => {
                    chrome.storage.local.get(['successfulEvents', 'reviewPromptDismissed'], resolve);
                });
                log(`Storage: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                log(`Error checking storage: ${error.message}`, 'error');
            }
        }

        async function clearStorage() {
            clearDebugOutput();
            try {
                await new Promise((resolve) => {
                    chrome.storage.local.clear(resolve);
                });
                log('Storage cleared successfully', 'success');
            } catch (error) {
                log(`Error clearing storage: ${error.message}`, 'error');
            }
        }

        async function setStorageValue() {
            clearDebugOutput();
            try {
                await new Promise((resolve) => {
                    chrome.storage.local.set({ successfulEvents: 2 }, resolve);
                });
                log('Set successfulEvents to 2', 'success');
            } catch (error) {
                log(`Error setting storage: ${error.message}`, 'error');
            }
        }

        function checkExtensionStatus() {
            clearDebugOutput();
            try {
                if (typeof extensionDebug !== 'undefined') {
                    extensionDebug.checkCurrentProvider().then(result => {
                        log(`Extension Status: ${JSON.stringify(result, null, 2)}`, 'success');
                    }).catch(error => {
                        log(`Error checking extension: ${error.message}`, 'error');
                    });
                } else {
                    log('Extension debug functions not available', 'warning');
                }
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }

        function testContentScript() {
            clearDebugOutput();
            try {
                if (typeof extensionDebug !== 'undefined') {
                    const info = extensionDebug.getContentScriptInfo();
                    log(`Content Script Info: ${JSON.stringify(info, null, 2)}`, 'success');
                } else {
                    log('Extension debug functions not available', 'warning');
                }
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }

        function showTestErrorModal() {
            clearDebugOutput();
            try {
                if (typeof showErrorModal !== 'undefined') {
                    showErrorModal();
                    log('Error modal triggered', 'success');
                } else {
                    log('showErrorModal function not available', 'warning');
                }
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }

        function showTestTimeoutModal() {
            clearDebugOutput();
            try {
                if (typeof showErrorModal !== 'undefined') {
                    showErrorModal('timeout');
                    log('Timeout error modal triggered', 'success');
                } else {
                    log('showErrorModal function not available', 'warning');
                }
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }

        // Add selection highlighting
        document.addEventListener('DOMContentLoaded', function() {
            const testTexts = document.querySelectorAll('.test-text');
            
            testTexts.forEach(element => {
                element.addEventListener('mouseup', function() {
                    const selection = window.getSelection();
                    if (selection.toString().length > 0) {
                        // Remove previous selections
                        testTexts.forEach(el => el.classList.remove('selected'));
                        // Highlight current selection
                        this.classList.add('selected');
                        log(`Text selected: "${selection.toString().substring(0, 50)}..."`, 'info');
                    }
                });
            });
        });

        // Log page load
        window.addEventListener('load', function() {
            log('Test page loaded successfully', 'success');
            log('Select any text above and right-click to test the extension', 'info');
        });
    </script>
</body>
</html>
